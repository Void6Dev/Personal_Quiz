{% extends "base.html" %}
{% load static %}
{% block content %}

{% block extra_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/quiz_question.css' %}">
{% endblock %}

<div class="quiz-container">
  <h2>{{ quiz.title|default:"Викторина" }}</h2>
  <p><strong>Вопрос {{ index }} из {{ total }}</strong></p>
  <p id="timer">Осталось времени: {{ timer }} сек</p>

  <form id="answerForm">
    {% csrf_token %}
    <input type="hidden" name="session_id" value="{{ session.id }}">
    <input type="hidden" name="question_id" value="{{ question.id }}">

    <div class="question-box">
      {% if question.text %}
        <p>{{ question.text }}</p>
      {% endif %}
      {% if question.image_url %}
        <img src="{{ question.image_url }}" alt="Изображение к вопросу" class="question-image"/>
      {% elif question.image %}
        <img src="{{ question.image.url }}" alt="Изображение к вопросу" class="question-image">
      {% endif %}
    </div>

    <div class="answers">
      {% for answer in answers %}
        <label class="answer-option">
          <input type="radio" name="answer_id" value="{{ answer.id }}" required>
          {% if answer.image_url %}
            <img src="{{ answer.image_url }}" alt="Изображение к ответу" class="answer-image"/>  
          {% elif answer.image %}
            <img src="{{ answer.image.url }}" alt="Изображение к ответу" class="answer-image"/>
          {% else %}
            {{ answer.text }}
          {% endif %}
        </label>
      {% endfor %}
    </div>
  </form>

  <button id="submitBtn" type="submit" class="submit-btn">Далее</button>
  <p id="statusMsg" style="color: green;"></p>
</div>

<script>
  window.timerValue = {{ timer }};
  window.submitUrl = "{% url 'submit_answer' session.id %}";
</script>

{% block extra_js %}
{{ block.super }}
<script src="{% static 'js/session_play.js' %}"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const options = document.querySelectorAll(".answer-option");
    options.forEach(option => {
      option.addEventListener("click", () => {
        options.forEach(o => o.classList.remove("active"));
        option.classList.add("active");
      });
    });
  });
</script>
{% endblock %}

{% endblock %}