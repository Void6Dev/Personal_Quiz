{% extends "base.html" %}
{% block content %}
    <h2>{{ quiz.title }}</h2>
    {% if request.user == quiz.creator %}
        <a href="{% url 'quiz_edit' quiz.id %}">‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
    {% endif %}
    <p><strong>–¢–µ–º–∞:</strong> {{ quiz.topic }}</p>
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ quiz.description }}</p>

    {% if quiz.image %}
        <img src="{{ quiz.image.url }}" alt="Quiz Image" style="max-width:300px;">
    {% endif %}
    <p>–í–æ–ø—Ä–æ—Å–æ–≤: {{ quiz.questions.count }}</p>

    <button id="startSessionBtn">üöÄ –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é</button>
    <p id="sessionResult"></p>
    <form id="joinForm" method="post">
        {% csrf_token %}
        <input type="text" name="code" id="sessionCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —Å–µ—Å—Å–∏–∏" required>
        <button type="submit">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
    </form>
    <p id="joinStatus"></p>
    <a href="{% url 'quiz_start' quiz.id %}" class="btn btn-primary">‚ñ∂ –ü—Ä–æ–π—Ç–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É</a>
    <br>
    <a href="{% url 'main_page' %}">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>


<script>
document.getElementById('startSessionBtn').addEventListener('click', function() {
    fetch("{% url 'session_create' %}", {
        method: "POST",
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'quiz_id': '{{ quiz.id }}'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'ok') {
            window.location.href = data.redirect_url;
        } else {
            document.getElementById('sessionResult').innerText = `–û—à–∏–±–∫–∞: ${data.message}`;
        }
    });
});
document.getElementById('joinForm').addEventListener('submit', function (e) {
    e.preventDefault();
    fetch("{% url 'join_session_by_code' %}", {
    method: "POST",
    headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "Content-Type": "application/x-www-form-urlencoded",
    },
    body: new URLSearchParams({
        code: document.getElementById('sessionCodeInput').value,
    }),
    })
    .then(res => res.json())
    .then(data => {
    if (data.status === 'ok') {
        window.location.href = data.redirect_url;
    } else {
        document.getElementById('joinStatus').innerText = data.message;
    }
    });
});
</script>
{% endblock %}