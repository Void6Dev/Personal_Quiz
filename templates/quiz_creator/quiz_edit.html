{% extends "base.html" %}
{% load static %}
{% load form_filters %}

{% block content %}
{% block extra_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/quiz_edit.css' %}">
{% endblock %}

<div class="edit-wrapper">
  <h2>{{ quiz.title }}</h2>
  <div class="content-columns">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ñ–æ—Ä–º–∞ -->
    <div class="form-column">
      <h3>–í–æ–ø—Ä–æ—Å</h3>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="answer-form">
          <div class="form-row">
            {{ question_form.text|add_class:"input" }}
          </div>
          <div class="form-row file-upload" style="position: relative;">
            <label class="file-label">
              {{ question_form.image }}
              <span class="file-name">üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
            </label>
            <img id="preview" style="position: absolute; top: 100%; left: 0; width: 150px; display: none; border: 1px solid #ccc; background: white;" />
          </div>
          {{ question_form.image_url|add_class:"input" }}
        </div>

        <h3>–û—Ç–≤–µ—Ç—ã</h3>
        <div id="form-container">
          {{ formset.management_form }}
          <div id="answers-container">
            {% for form in formset %}
              {% include "quiz_creator/includes/answer_form.html" with form=form %}
            {% endfor %}
          </div>
        </div>

        <button type="button" class="btn" id="add-answer-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
        <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
      </form>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
    <div class="questions-column">
      <h3>–£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>

      {% if questions %}
        <ul class="question-list">
          {% for question in questions %}
            <li class="question-item">
              <p><strong>{{ forloop.counter }}. {{ question.text }}</strong>
                {% if question.image %}
                  <br><img src="{{ question.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞" class="question-image" />
                {% endif %}
              </p>
              <ul class="answer-list">
                {% for answer in question.answers.all %}
                  <li class="answer-item">
                    {{ answer.text }}
                    {% if answer.image %}
                      <img src="{{ answer.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞" class="answer-image" />
                    {% endif %}
                    {% if answer.is_correct %}‚úÖ{% endif %}
                  </li>
                {% endfor %}
              </ul>
              <form method="post" action="{% url 'question_delete' quiz.id question.id %}">
                {% csrf_token %}
                <button type="submit" class="delete-answer">üóë –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤.</p>
      {% endif %}
    </div>
  </div>
  <form method="post" action="{% url 'quiz_finish' quiz.id %}">
    {% csrf_token %}
    <button type="submit" class="finish-btn" {% if questions|length == 0 %}disabled{% endif %}>‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ</button>
  </form>
</div>

<div id="answer-form-template" style="display: none;">
  {% with form=formset.empty_form %}
    {% include "quiz_creator/includes/answer_form.html" with form=form %}
  {% endwith %}
</div>

{% block extra_js %}
  {{ block.super }}
  <script src="{% static 'js/quiz_edit.js' %}"></script>
{% endblock %}
{% endblock %}
